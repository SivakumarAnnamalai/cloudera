[root@ccycloud-1 tls]# cat cert-info.txt 
COUNTRY=US
STATE=TX
LOCAL="The Woodlands"
ORG=CLDR
ORG_UNIT=PS
PASSWORD=cloudera123
[root@ccycloud-1 tls]# cat hosts.txt 
ccycloud-1.cdp-tls3.root.hwx.site1
ccycloud-2.cdp-tls3.root.hwx.site1
ccycloud-3.cdp-tls3.root.hwx.site1
ccycloud-4.cdp-tls3.root.hwx.site1
ccycloud-5.cdp-tls3.root.hwx.site1
[root@ccycloud-1 tls]# cat cert-creation.sh 
#!/bin/bash

hosts_file="hosts.txt"
source `pwd`/cert-info.txt

for node in `cat $hosts_file`
do
csrFile=${node}.csr
echo "Generating for $node"
openssl req -new -newkey rsa:2048 -keyout ${node}.key -passout pass:$PASSWORD \
-out ${csrFile} \
-subj "/C=$COUNTRY/ST=$STATE/L=$LOCAL/O=$ORG/OU=$ORG_UNIT/CN=$node" \
-addext "subjectAltName = DNS:foo.co.uk" 
echo "Signing the Certificate with the CA or Intermediate CA"
certText=$(awk 'NF {sub(/\r/, ""); printf "%s\\n",$0;}' ${csrFile})
curl -s -d "{\"certificate_request\": \"${certText}\"}" http://ca.lab.atx.cloudera.com/api/v1/cfssl/sign \
| python -c 'import sys, json; print json.load(sys.stdin)["result"]["certificate"]' > ${csrFile}.pem

done
